<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frozen City 3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: #000;
            color: white;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
        }
        
        #gameContainer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2;
        }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            font-weight: bold;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.5);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px 40px;
            border-radius: 15px;
            border: 2px solid #4fc3f7;
            z-index: 100;
        }
        
        .buildings-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            pointer-events: all;
        }
        
        .building-btn {
            width: 80px;
            height: 80px;
            background: rgba(30, 40, 90, 0.8);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .building-btn:hover {
            transform: translateY(-5px);
            border-color: #4fc3f7;
            box-shadow: 0 5px 15px rgba(79, 195, 247, 0.3);
        }
        
        .building-icon {
            font-size: 24px;
        }
        
        .building-name {
            font-size: 12px;
            text-align: center;
        }
        
        .building-level {
            font-size: 10px;
            color: #4fc3f7;
        }
        
        .resources {
            position: absolute;
            top: 20px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .resource {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 16px;
        }
        
        .controls-info {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 12px;
            line-height: 1.4;
        }
        
        .snowflakes {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
        }
        
        .snowflake {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            animation: fall linear infinite;
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh);
            }
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="loading pulse"># –ó–∞–≥—Ä—É–∑–∫–∞ Frozen City...</div>
    <div id="gameContainer"></div>
    
    <div class="ui-overlay">
        <div class="resources">
            <div class="resource">
                <span>ü•ï –ï–¥–∞: <span id="food-count">150</span></span>
            </div>
            <div class="resource">
                <span>üå≤ –î–µ—Ä–µ–≤–æ: <span id="wood-count">80</span></span>
            </div>
            <div class="resource">
                <span>‚õ∞Ô∏è –ö–∞–º–µ–Ω—å: <span id="stone-count">45</span></span>
            </div>
            <div class="resource">
                <span>‚ö´ –£–≥–æ–ª—å: <span id="coal-count">30</span></span>
            </div>
        </div>
        
        <div class="controls-info">
            –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:<br>
            ‚Ä¢ –ö–æ–ª–µ—Å–∏–∫–æ - –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ<br>
            ‚Ä¢ –õ–ö–ú + –¥–≤–∏–∂–µ–Ω–∏–µ - –≤—Ä–∞—â–µ–Ω–∏–µ<br>
            ‚Ä¢ –ü–ö–ú + –¥–≤–∏–∂–µ–Ω–∏–µ - –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏–µ
        </div>
        
        <div class="buildings-panel">
            <div class="building-btn" onclick="buildBuilding('hut')">
                <div class="building-icon">üè†</div>
                <div class="building-name">–•–∏–∂–∏–Ω–∞</div>
                <div class="building-level">–£—Ä. 2</div>
            </div>
            <div class="building-btn" onclick="buildBuilding('sawmill')">
                <div class="building-icon">üå≤</div>
                <div class="building-name">–õ–µ—Å–æ–ø–∏–ª–∫–∞</div>
                <div class="building-level">–£—Ä. 1</div>
            </div>
            <div class="building-btn" onclick="buildBuilding('quarry')">
                <div class="building-icon">‚õ∞Ô∏è</div>
                <div class="building-name">–ö–∞–º–µ–Ω–æ–ª–æ–º–Ω—è</div>
                <div class="building-level">–£—Ä. 1</div>
            </div>
            <div class="building-btn" onclick="buildBuilding('mine')">
                <div class="building-icon">‚õèÔ∏è</div>
                <div class="building-name">–®–∞—Ö—Ç–∞</div>
                <div class="building-level">–£—Ä. 1</div>
            </div>
            <div class="building-btn" onclick="buildBuilding('farm')">
                <div class="building-icon">üåæ</div>
                <div class="building-name">–§–µ—Ä–º–∞</div>
                <div class="building-level">–£—Ä. 1</div>
            </div>
        </div>
        
        <div class="snowflakes" id="snowflakes"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // 3D —Å—Ü–µ–Ω–∞
        let scene, camera, renderer, controls;
        let buildings = [];
        let villagers = [];
        let isDragging = false;
        let previousMousePosition = { x: 0, y: 0 };
        
        function init() {
            // –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É
            scene = new THREE.Scene();
            
            // –°–æ–∑–¥–∞–µ–º –Ω–µ–±–æ
            const skyGeometry = new THREE.SphereGeometry(500, 32, 32);
            const skyMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x87CEEB,
                side: THREE.BackSide
            });
            const sky = new THREE.Mesh(skyGeometry, skyMaterial);
            scene.add(sky);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—É–º–∞–Ω –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã
            scene.fog = new THREE.Fog(0x87CEEB, 100, 300);
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞–º–µ—Ä—É
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(25, 20, 25);
            camera.lookAt(0, 0, 0);
            
            // –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.getElementById('gameContainer').appendChild(renderer.domElement);
            
            // –û—Å–≤–µ—â–µ–Ω–∏–µ
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // –°–æ–∑–¥–∞–µ–º –∑–µ–º–ª—é —Å —Ç–µ–∫—Å—Ç—É—Ä–æ–π
            createGround();
            
            // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –∑–¥–∞–Ω–∏—è
            createInitialBuildings();
            
            // –°–æ–∑–¥–∞–µ–º –∂–∏—Ç–µ–ª–µ–π
            createVillagers();
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ä–µ–≤—å—è –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã
            createTrees();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä–æ–π
            setupCameraControls();
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            setTimeout(() => {
                document.querySelector('.loading').style.display = 'none';
            }, 2000);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            animate();
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
            window.addEventListener('resize', onWindowResize);
        }
        
        function createGround() {
            // –û—Å–Ω–æ–≤–Ω–∞—è –∑–µ–º–ª—è
            const groundGeometry = new THREE.PlaneGeometry(200, 200, 50, 50);
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º –æ—Ç —Ç—Ä–∞–≤—ã –∫ —Å–Ω–µ–≥—É
            const vertexShader = `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `;
            
            const fragmentShader = `
                varying vec2 vUv;
                void main() {
                    // –ì—Ä–∞–¥–∏–µ–Ω—Ç –æ—Ç –∑–µ–ª–µ–Ω–æ–≥–æ (—Ç—Ä–∞–≤–∞) –∫ –±–µ–ª–æ–º—É (—Å–Ω–µ–≥) –ø–æ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–µ
                    vec3 grassColor = vec3(0.2, 0.6, 0.3);
                    vec3 snowColor = vec3(0.9, 0.9, 0.95);
                    float mixValue = smoothstep(0.3, 0.7, vUv.y);
                    vec3 finalColor = mix(grassColor, snowColor, mixValue);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–º–Ω–æ–≥–æ —à—É–º–∞ –¥–ª—è —Ç–µ–∫—Å—Ç—É—Ä—ã
                    float noise = fract(sin(dot(vUv, vec2(12.9898, 78.233))) * 43758.5453) * 0.1;
                    finalColor += noise;
                    
                    gl_FragColor = vec4(finalColor, 1.0);
                }
            `;
            
            const groundMaterial = new THREE.ShaderMaterial({
                vertexShader: vertexShader,
                fragmentShader: fragmentShader
            });
            
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ç–∫—É –¥–ª—è –ª—É—á—à–µ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
            const gridHelper = new THREE.GridHelper(200, 20, 0x444444, 0x222222);
            gridHelper.position.y = 0.01;
            scene.add(gridHelper);
        }
        
        function createTrees() {
            // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–µ—Ä–µ–≤—å–µ–≤
            for (let i = 0; i < 30; i++) {
                const tree = new THREE.Group();
                
                // –°—Ç–≤–æ–ª
                const trunkGeometry = new THREE.CylinderGeometry(0.3, 0.4, 3, 8);
                const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                trunk.position.y = 1.5;
                tree.add(trunk);
                
                // –ö—Ä–æ–Ω–∞
                const crownGeometry = new THREE.SphereGeometry(2, 8, 6);
                const crownMaterial = new THREE.MeshLambertMaterial({ color: 0x2E8B57 });
                const crown = new THREE.Mesh(crownGeometry, crownMaterial);
                crown.position.y = 4;
                tree.add(crown);
                
                // –°–ª—É—á–∞–π–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
                const x = (Math.random() - 0.5) * 180;
                const z = (Math.random() - 0.5) * 180;
                tree.position.set(x, 0, z);
                
                tree.castShadow = true;
                scene.add(tree);
            }
        }
        
        function createInitialBuildings() {
            createBuilding('hut', -15, 0, -10);
            createBuilding('hut', -8, 0, -15);
            createBuilding('sawmill', 10, 0, -12);
            createBuilding('quarry', 15, 0, 8);
            createBuilding('farm', -5, 0, 12);
            createBuilding('mine', 20, 0, -5);
        }
        
        function createBuilding(type, x, y, z) {
            let geometry, material, building;
            
            switch(type) {
                case 'hut':
                    geometry = new THREE.BoxGeometry(4, 3, 4);
                    material = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                    building = new THREE.Mesh(geometry, material);
                    
                    // –ö—Ä—ã—à–∞
                    const roofGeometry = new THREE.ConeGeometry(3, 2, 4);
                    const roofMaterial = new THREE.MeshLambertMaterial({ color: 0x654321 });
                    const roof = new THREE.Mesh(roofGeometry, roofMaterial);
                    roof.rotation.y = Math.PI / 4;
                    roof.position.y = 2.5;
                    building.add(roof);
                    break;
                    
                case 'sawmill':
                    geometry = new THREE.BoxGeometry(6, 4, 5);
                    material = new THREE.MeshLambertMaterial({ color: 0x2E8B57 });
                    building = new THREE.Mesh(geometry, material);
                    
                    // –ö—Ä—ã—à–∞ –ª–µ—Å–æ–ø–∏–ª–∫–∏
                    const sawmillRoofGeometry = new THREE.CylinderGeometry(0.5, 3, 1, 3);
                    const sawmillRoofMaterial = new THREE.MeshLambertMaterial({ color: 0x654321 });
                    const sawmillRoof = new THREE.Mesh(sawmillRoofGeometry, sawmillRoofMaterial);
                    sawmillRoof.rotation.x = Math.PI / 2;
                    sawmillRoof.position.y = 3;
                    building.add(sawmillRoof);
                    break;
                    
                case 'quarry':
                    geometry = new THREE.BoxGeometry(5, 3, 5);
                    material = new THREE.MeshLambertMaterial({ color: 0x696969 });
                    building = new THREE.Mesh(geometry, material);
                    break;
                    
                case 'mine':
                    geometry = new THREE.CylinderGeometry(2, 3, 4, 8);
                    material = new THREE.MeshLambertMaterial({ color: 0x2F4F4F });
                    building = new THREE.Mesh(geometry, material);
                    
                    // –®–∞—Ö—Ç–Ω–∞—è –±–∞—à–Ω—è
                    const mineTowerGeometry = new THREE.CylinderGeometry(0.5, 0.5, 6, 8);
                    const mineTowerMaterial = new THREE.MeshLambertMaterial({ color: 0x555555 });
                    const mineTower = new THREE.Mesh(mineTowerGeometry, mineTowerMaterial);
                    mineTower.position.y = 5;
                    building.add(mineTower);
                    break;
                    
                case 'farm':
                    geometry = new THREE.BoxGeometry(8, 2, 6);
                    material = new THREE.MeshLambertMaterial({ color: 0xDAA520 });
                    building = new THREE.Mesh(geometry, material);
                    
                    // –ö—Ä—ã—à–∞ —Ñ–µ—Ä–º—ã
                    const farmRoofGeometry = new THREE.ConeGeometry(5, 2, 4);
                    const farmRoofMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
                    const farmRoof = new THREE.Mesh(farmRoofGeometry, farmRoofMaterial);
                    farmRoof.rotation.y = Math.PI / 4;
                    farmRoof.position.y = 2.5;
                    building.add(farmRoof);
                    break;
            }
            
            building.position.set(x, y, z);
            building.castShadow = true;
            building.receiveShadow = true;
            building.userData = { type: type };
            
            scene.add(building);
            buildings.push(building);
            
            return building;
        }
        
        function createVillagers() {
            for (let i = 0; i < 8; i++) {
                createVillager();
            }
        }
        
        function createVillager() {
            const villager = new THREE.Group();
            
            // –¢–µ–ª–æ
            const bodyGeometry = new THREE.CylinderGeometry(0.4, 0.4, 1.2, 8);
            const bodyMaterial = new THREE.MeshLambertMaterial({ color: Math.random() > 0.5 ? 0x3498db : 0xe74c3c });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            villager.add(body);
            
            // –ì–æ–ª–æ–≤–∞
            const headGeometry = new THREE.SphereGeometry(0.5, 8, 8);
            const headMaterial = new THREE.MeshLambertMaterial({ color: 0xFFE0B2 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 1.1;
            villager.add(head);
            
            // –°–ª—É—á–∞–π–Ω–∞—è –Ω–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è
            const x = (Math.random() - 0.5) * 40;
            const z = (Math.random() - 0.5) * 40;
            villager.position.set(x, 1, z);
            
            villager.castShadow = true;
            scene.add(villager);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–≤–∏–∂–µ–Ω–∏—è
            villager.userData = {
                speed: 0.03 + Math.random() * 0.02,
                targetX: x,
                targetZ: z,
                idleTime: 0
            };
            
            villagers.push(villager);
        }
        
        function setupCameraControls() {
            const canvas = renderer.domElement;
            
            // –í—Ä–∞—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –ø—Ä–∏ –∑–∞–∂–∞—Ç–æ–π –õ–ö–ú
            canvas.addEventListener('mousedown', (event) => {
                if (event.button === 0) { // –õ–ö–ú
                    isDragging = true;
                    previousMousePosition = { x: event.clientX, y: event.clientY };
                }
            });
            
            canvas.addEventListener('mousemove', (event) => {
                if (isDragging) {
                    const deltaX = event.clientX - previousMousePosition.x;
                    const deltaY = event.clientY - previousMousePosition.y;
                    
                    // –í—Ä–∞—â–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã –≤–æ–∫—Ä—É–≥ —Ü–µ–Ω—Ç—Ä–∞ —Å—Ü–µ–Ω—ã
                    const angleX = deltaY * 0.01;
                    const angleY = deltaX * 0.01;
                    
                    camera.position.x = camera.position.x * Math.cos(angleY) - camera.position.z * Math.sin(angleY);
                    camera.position.z = camera.position.z * Math.cos(angleY) + camera.position.x * Math.sin(angleY);
                    
                    camera.position.y = Math.max(5, Math.min(50, camera.position.y - deltaY * 0.1));
                    camera.lookAt(0, 0, 0);
                    
                    previousMousePosition = { x: event.clientX, y: event.clientY };
                }
            });
            
            canvas.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            canvas.addEventListener('mouseleave', () => {
                isDragging = false;
            });
            
            // –ü—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ/–æ—Ç–¥–∞–ª–µ–Ω–∏–µ –∫–æ–ª–µ—Å–∏–∫–æ–º
            canvas.addEventListener('wheel', (event) => {
                event.preventDefault();
                const zoomSpeed = 0.
